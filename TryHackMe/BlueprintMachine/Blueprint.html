<html><head>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f4f4f4;
    }
    h1, h2, h3 {
        color: #333;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    p {
        margin-bottom: 20px;
    }
    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto 20px auto;
    }
    code {
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 5px;
    }
    pre {
        background-color: #333;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
    }
</style>
</head><body><h2>Reconnaissance:</h2>

<p>First of all, to understand whether machine live or not try to
<code>ping</code> it.</p>

<p><code>
ping 10.10.118.119
</code></p>

<p>The output should look like:</p>

<p><img src="./images/1.png" alt="alt text" /></p>

<p>Add your ip address to <code>/etc/hosts</code> file.</p>

<p><code>
nano /etc/host
</code></p>

<p>Include your ip address the format provided below:</p>

<p><img src="./images/2.png" alt="alt text" /></p>

<p>Before move on, I highly recommend you to check manually whether <code>web application</code> runs on <code>port 80/443</code> via browser. In most scenarios, we will not have https protocol.</p>

<p><code>
//The route that you need to follow is:
http://blueprint.thm
</code></p>

<p>This route automatically interact with HTTP protocol. Most of the time browsers have default routing mechanism directing to port 443. We should always try to route port 80 by just manually adding <code>http://</code></p>

<p><img src="./images/3.png" alt="alt text" /></p>

<p>Recently, I also tried to check <code>Apache</code> commonly running on port 8080:</p>

<p><img src="./images/4.png" alt="alt text" /></p>

<p>As you can see above, we have an directory named <code>oscommerce-2.3.4</code>. I was curious about it ,so I searched about our Operating System commerce app.</p>

<p><img src="./images/5.png" alt="alt text" /></p>

<p>It is clear that we should trigger RCE through web app. However, further reconnaissance is not harmful :) I also wanted to <code>fuzz</code> this route <code>http://blueprint:8080</code></p>

<p>For the fuzzing, I thought that <code>dirsearch</code> and <code>dirb</code> will be suitable:</p>

<p><code>Dirsearch</code> payload:</p>

<p><code>
dirsearch -u http://blueprint.thm:8080
</code></p>

<p><img src="./images/6.png" alt="alt text" /></p>

<p>I just got <code>/server-status/</code>, <code>/server-info</code> paths. Capturing server data is useful for the architectural understanding. Let me extract what we have so far !</p>

<p><img src="./images/7.png" alt="alt text" /></p>

<p>I was dealing with <code>Win32</code> architecture, <code>Apache</code> as a web server and for the backend <code>PHP</code> working on the machine. Furthermore, on <code>/oscommerce-2.3.4/docs/</code> path, there was a database dump. However, I could not reach any juicy information.</p>

<p><img src="./images/8.png" alt="alt text" /></p>

<p>The <code>database scheme</code> pattern looks like <code>ER diagram</code>.</p>

<p>Nmap was beneficial to get extended data about application:</p>

<p>Nmap Payloads:
```
sudo nmap -sV -sC blueprint.thm</p>

<p>sudo nmap -sV -sC -p- blueprint.thm
```</p>

<p>Since I have already get what we need especially architecture of the application. I preferred to use only <code>default script</code> scan. Moreover, full port scan was not compatible on this scenario because it ran really slow. Anyway, let's check the <code>network mapper</code> output.</p>

<p><img src="./images/9.png" alt="alt text" /></p>

<p>The results depicted that I did not check only the port <code>445</code> as known as <code>SMB</code> (Server Message Block).</p>

<p><img src="./images/10.png" alt="alt text" /></p>

<p><code>Nmap</code> script engine automatically run <code>default smb scripts</code> against on target. Lastly, checking the SMB will be crucial to get initial compromise since <code>nmap</code> script result revealed the potential discovery on <code>SMB</code>.</p>

<p>According to <code>HackTricks</code>, we can use <code>enum4linux</code> to enumerate the target:</p>

<p><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb">Pentesting SMB</a></p>

<p><img src="./images/11.png" alt="alt text" /></p>

<p><code>
enum4linux -a 10.10.118.119
</code></p>

<p>The most identical part of the <code>enum4linux</code> output was the <code>nbtstat information</code>.</p>

<p><img src="./images/12.png" alt="alt text" /></p>

<p>Script could get the <code>Domain/Workgroup</code> named <code>WORKGROUP</code>. Let me try to authenticate it through without giving credentials.</p>

<p><img src="./images/13.png" alt="alt text" /></p>

<p><code>
    //IPC$ did not allow me to run any commands
    ──(root㉿kali)-[/home/kali]
    └─# smbclient -U '%' -N \\\\10.10.118.119\\IPC$  
    Try "help" to get a list of possible commands.
    smb: \&gt; dir
    NT_STATUS_ACCESS_DENIED listing \*
    smb: \&gt; whoami
    whoami: command not found
    smb: \&gt; ls
    NT_STATUS_ACCESS_DENIED listing \*
    smb: \&gt; 
</code></p>

<p>SMB did not give me useful findings. Therefore, I switched on exploitdb to get initial compromise.</p>

<p><a href="https://www.exploit-db.com/exploits/44374">RCE</a></p>

<p><img src="./images/14.png" alt="alt text" /></p>

<p>There was a web app based vulnerability occurs ,so let me apply this manually before I demonstrate all the ways to compromise machine.</p>

<p>Specifically, <code>PHP engine</code> shows an error the path <code>/install.php?step=4</code>. DB configuration error occured.</p>

<p><img src="./images/15.png" alt="alt text" /></p>

<p>I intended to do directly manual without any tool ,but it did not work. That's why, lets run `manual exploit</p>

<p>Firstly, edit the 
<code>url</code> part of the script:</p>

<p><img src="./images/15.png" alt="alt text" /></p>

<p>As you can see below, it did not work because the script automatically tried to execute <code>system('ls')</code> command on the OS.</p>

<p><img src="./images/16.png" alt="alt text" /></p>

<p>However, the web app disabled such commands by default ,so lets run another payload from <a href="https://github.com/nobodyatall648/osCommerce-2.3.4-Remote-Command-Execution">Github</a></p>

<p>To understand how the script works, I initially run it just by no parameters and inputs.</p>
</body></html>