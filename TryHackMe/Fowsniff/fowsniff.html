<html><head>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f4f4f4;
    }
    h1, h2, h3 {
        color: #333;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    p {
        margin-bottom: 20px;
    }
    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto 20px auto;
    }
    code {
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 5px;
    }
    pre {
        background-color: #333;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
    }
</style>
</head><body><p>Hi everyone, today I would like to analyze the CTF challenge called <code>Fowsniff</code> from TryHackMe platform. Before I begin, I want to include my ipv4 address to <code>/etc/hosts</code> file to make more accessible the way we are reaching the host.</p>

<p><img src="./images/1.png" alt="alt text" /></p>

<p>Let me check the port <code>80</code> and <code>443</code> to understand whether we have active web application or not through the browser.</p>

<p><img src="./images/2.png" alt="alt text" /></p>

<p>After I viewed page source, I understood that there were not any suspicious code segment on <code>html</code> or <code>js</code>.</p>

<h2>Reconnaissance:</h2>

<p>I initially conducted fuzzing ,but I could not reach useful paths. The room recommended us to make manual OSINT. You can reach out what I have accessed below:</p>

<p><a href="https://x.com/fowsniffcorp?lang=en">Twitter</a>
<a href="https://github.com/berzerk0/Fowsniff/blob/main/fowsniff.txt">GitHub</a></p>

<p>On <code>GitHub</code> I retrieved a couple of <code>mail accounts</code> regarding to our machine. </p>

<p><code>
mauer@fowsniff:8a28a94a588a95b80163709ab4313aa4
mustikka@fowsniff:ae1644dac5b77c0cf51e0d26ad6d7e56
tegel@fowsniff:1dc352435fecca338acfd4be10984009
baksteen@fowsniff:19f5af754c31f1e2651edde9250d69bb
seina@fowsniff:90dc16d47114aa13671c697fd506cf26
stone@fowsniff:a92b8a29ef1183192e3d35187e0cfabd
mursten@fowsniff:0e9588cb62f4b6f27e33d449e2ba0b3b
parede@fowsniff:4d6e42f56e127803285a0a7649b5ab11
sciana@fowsniff:f7fd98d380735e859f8b2ffbbede5a7e
</code></p>

<p><a href="https://crackstation.net/">CrackStation</a> helped me to decrypt messages directly. However, you can also use <a href="https://www.dcode.fr/cipher-identifier">dcrypt</a> to identify and decrypt it.</p>

<p>Let me also conduct port scan via <code>network mapper</code>.</p>

<p>I did not create advanced payload for <code>port scanning</code> since I knew that I was dealing with CTF machine. That's why, service, <code>default script</code> and <code>full port scan</code>(because I could not reach any endpoints on fuzzing) options are enough to handle the machine.</p>

<p>Payload:</p>

<p><code>
sudo nmap -sV -sC -p- fowsniff.thm
</code></p>

<p><img src="./images/3.png" alt="alt text" /></p>

<p>It is clear that I gathered <code>mail</code> account's <code>user:pass</code> combination. Let's try to use them on <code>IMAP</code> and <code>POP3</code>. There were a lot of accounts some of them included <code>MD5</code> hashes, decrypted correctly ,but others did not result in properly. Therefore, <code>bruteforcing</code> should be suitable on that stuff. Furthermore, the creator of machine suggests that using <code>metasploit's pop3_login</code> module is recommended way.</p>

<p>You should use <code>auxiliary/scanner/pop3/pop3_login</code> to brute-force accounts respectively. Let's look how <code>module</code> works:</p>

<p>first of all, run this command to access module:</p>

<p><code>
use auxiliary/scanner/pop3/pop3_login
</code></p>

<p>Then configure your module:
<code>
show options
set RPORT (use current one 110)
set RHOSTS #target IP address
</code></p>

<p><code>pop3_login</code> requires attackers to give paths for both <code>username</code> and <code>password</code> files ,so I created separated files named <code>user.txt</code> and <code>pass.txt</code> with the combination of <code>username@domain</code> and <code>password</code> respectively.</p>

<p><img src="./images/8.png" alt="alt text" /></p>

<p>In my first try, I could not find correct match because of the format of the <code>user</code>. Normally, we should directly give the username with correlated <code>username@domain</code> combination ,but on this machine it did not allow me to authenticate via <code>username@domain</code> combination.</p>

<p><img src="./images/7.png" alt="alt text" /></p>

<p><a href="https://unix.stackexchange.com/questions/201818/checking-pop-mail-account-using-terminal">Normal authentication process</a></p>

<p><code>man</code> page of the <code>telnet</code> protocol did not give useful results about it:</p>

<p><img src="./images/9.png" alt="alt text" /></p>

<p>I thought that I can also look the module's source code to understand the format of the <code>username</code> and <code>password</code> files.</p>

<p><img src="./images/10.png" alt="alt text" /></p>

<p>I just opened open only the <code>username</code> file:
<img src="./images/11.png" alt="alt text" /></p>

<p>I recognized that module directly combines <code>user:pass</code> not the <code>@domain</code> part.
That's why, I altered the <code>user</code> and <code>pass</code> files.</p>

<p><img src="./images/6.png" alt="alt text" /></p>

<p>Fire ! ! !
<img src="./images/12.png" alt="alt text" /></p>

<p>Gotcha ! 
After a long time, I finally compromised valid credentials. Let's move on how to communicate with <code>POP3</code>.</p>

<p>As far as I remember from computer networks course, <code>IMAP</code> stores emails through <code>persistent storage</code> ,but <code>pop3</code> firstly downloads emails temporarily then make readable for <code>client</code>. On this instance, I only discovered that how to communicate with <code>telnet</code> protocol part in order to communicate with <code>mail</code>server. Since there was not any strategical protocol except the <code>http</code>, I directly began how can I interact with <code>IMAP</code> or <code>POP3</code>. 
Today, I will only show you the way we deal with <code>pop3</code> to be able to retrieve emails. You can reach out from below:</p>

<p><a href="[http://kb.ictbanking.net/article.php?id=488](http://kb.ictbanking.net/article.php?id=488)">POP3 usage guideline</a></p>

<p>Both protocols can be suitable for <code>telnet</code> as a client program. Now let me use such command:</p>

<p><code>
[protocol name], [IPv4], [port number]
telnet 10.10.50.41 110
</code></p>

<p><code>Telnet</code> is an outdated protocol because of the <code>insufficient message encryption</code> used for multiple operations on remote host until <code>SSH</code> released.</p>

<p><img src="./images/4.png" alt="alt text" /></p>

<p>As you can see above, I already connected remote host, <code>POP3 server</code>. After initial connection, It asked me to give credentials before I execute commands.
That's why, run these commands respectively:</p>

<p><code>
USER [username]
PASS [password]
LIST # list the current messages
</code></p>

<p><img src="./images/5.png" alt="alt text" /></p>

<p><code>Seina</code> user has currently two messages.
To read content of the messages, we should retrieve messages:</p>

<p><img src="./images/13.png" alt="alt text" /></p>

<p>I would not give all the message content. Instead, I wanted to show the most crucial highlights of it.</p>

<h3>Message 1 Output:</h3>

<p><img src="./images/18.png" alt="alt text" /></p>

<h3>Message 2 Output</h3>

<p><img src="./images/19.png" alt="alt text" /></p>

<p>It would be beneficial to try every mail user especially on <code>SSH</code> authentication.
To authenticate <code>ssh</code>, use below command:</p>

<p><code>
ssh seina@[ipv4 address]
ssh stone@[ipv4 address]
ssh baksteen@[ipv4 address]
</code></p>

<p>I straightforwardly tried all of them then I got shell from <code>baksteen</code> user.</p>

<p><img src="./images/14.png" alt="alt text" /></p>

<p>Firstly, before I upload <code>linpeas</code>. Let's apply manual approaches:</p>

<h3>1) sudo -l</h3>

<p>Understanding which commands <code>user</code> can run is significant for initial enumeration to escalate privileges.</p>

<h3>2) Basic Directory Enumeration</h3>

<p>Finding were important especially for this machine because every words have a lot of meaning in entire CTF session.</p>

<h3>3) Binary Discovery</h3>

<p>As you know, <code>GFTObins</code> is really essential part in most of the <code>Capture The Flag machines</code> phases ,so I also did not forget to check useful binaries like python in this scenario.</p>

<p><img src="./images/15.png" alt="alt text" /></p>

<h3>4) OS Discovery &amp; Permission Check</h3>

<p>As you can see below, I used a <code>privilege escalation</code> <code>GFTObin</code> payload:</p>

<p><code>
sudo python -c 'import os; os.system("/bin/sh")'
</code></p>

<p>If a user allowed to run run as superuser by <code>sudo</code>, it does not drop the elevated privileges. Instead, it will escalate privileges ,but it did not work. Even if I changed version of the python, it gave me the same result.</p>

<p><img src="./images/16.png" alt="alt text" /></p>

<p>Retrieving essential system information is sometimes useful for <code>custom binary</code> exploitation. Besides, reaching the hierarchy of the user is also important aspect in <code>OS enumeration</code>.</p>

<p>Further <code>binary check</code> can be seen below.</p>

<p><img src="./images/17.png" alt="alt text" />
I intentionally searched for specific <code>binaries</code> to download <code>linpeas</code> from local since I was not able to find any evidence to escalate my privileges.</p>

<p>I deployed  <code>python web server</code> via my local host then downloaded from <code>target</code>.</p>

<p><img src="./images/20.png" alt="alt text" /></p>

<p><code>GET</code> request and <code>my local path</code> indicating something downloaded from my local host. After I executed linpeas by giving executable permission through <code>chmod +x</code>,   I observed many evidences about machine ,yet I just only gave you the most important ones.</p>

<p><img src="./images/21.png" alt="alt text" />
We can execute, write or read everything we want on our home directory. However, we do not need such thing in this scenario.</p>

<p>A file called <code>cube.sh</code> is so clear to try many escalation vectors.</p>

<p><img src="./images/22.png" alt="alt text" /></p>

<p>The creator of the machine embedded a <code>misconfigured code part</code> on:
<code>/etc/update-motd.d</code>. It can be observable on <code>linpeas</code> output. Furthermore, at the end of the configuration script, there was a script mistakenly running automatically.</p>

<p><code>
sh /opt/cube/cube.sh
</code></p>

<p>Hence, I understood that If I place a <code>reverse shell</code> on <code>cube.sh</code>. System will automatically forward my <code>reverse shell</code> to my local. To make it accomplishable, deploying <code>netcat</code> listener then logout and login the <code>SSH</code> client is most probably suitable in this condition.</p>

<p>I thought that if I somehow execute something on <code>cube.sh</code> as <code>users group</code>, I can fully escalate my privilege through <code>update-motd.d</code> system file. To do this we can drop <code>reverse shell</code> on <code>cube.sh</code>. Let me try it:</p>

<p><img src="./images/23.png" alt="alt text" /></p>

<p>At first, I forgot to add <code>#!/bin/bash</code> ,so it did not work because it is necessary to work with any <code>bash script</code> . It is like a <code>include &lt;stdio.h&gt;</code> in C programming ,so If it is not exist your script will not be executed.</p>

<h3><em>Wrong Way</em></h3>

<p><img src="./images/24.png" alt="alt text" /></p>

<h3>Corrected !</h3>

<p><img src="./images/25.png" alt="alt text" /></p>

<p>Once you done your payload, you just need to run once then please logout on your ssh session then login.</p>

<p><img src="./images/26.png" alt="alt text" /></p>

<p>We are done ! ! !</p>

<p>May The Pentest Be With You ! ! !</p>

<p><img src="./images/PHOTO-2024-10-13-17-24-35.jpg" alt="alt text" /></p>
</body></html>