<html><head>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f4f4f4;
    }
    h1, h2, h3 {
        color: #333;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    p {
        margin-bottom: 20px;
    }
    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto 20px auto;
    }
    code {
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 5px;
    }
    pre {
        background-color: #333;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
    }
</style>
</head><body><p>Hi everyone today I will analyze the machine called "Lianyu" on <strong>TryHackMe</strong> platform. Before you begin please add your <code>ipv4</code> address to <code>/etc/hosts</code>.</p>

<p><img src="./images/1.png" alt="alt text" /></p>

<p>Firstly, run your <code>VPN</code> file then try to <code>ping</code> the target so that you can understand whether you can communicate with target server or not.</p>

<p><img src="./images/2.png" alt="alt text" /></p>

<p>Gotcha !</p>

<h2>Reconnaissance:</h2>

<p>Now, finally, checking the most common port is beneficial for us because of the penetration testing time restrictions.</p>

<p>Payload:</p>

<p><code>
curl http://lianyu.thm:80
curl http://lianyu.thm:8080
</code></p>

<p><img src="./images/3.png" alt="alt text" /></p>

<p><img src="./images/4.png" alt="alt text" /></p>

<p>As you can see, I did not have such application instances on ports <code>8080</code> and <code>443</code> respectively. </p>

<p><code>Wappalayzer</code> just showed the web server software.</p>

<p><img src="./images/5.png" alt="alt text" /></p>

<p>There were nothing interesting on <code>Page Source</code> ,so let me move on <code>automated reconnaissance</code>. After I used <code>common.txt</code> located on <code>dirb</code> directory I decided to use <code>directory-list-medium-2.3-medium.txt</code> then it gave me just one endpoint on our web application.</p>

<p><code>
dirsearch -u http://lianyu.thm -w/usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium. txt
</code></p>

<p><img src="./images/6.png" alt="alt text" />
I also applied extended fuzzing especially on <code>island</code> endpoint ,so applying <code>directory-list-2.3-medium.txt</code> was suitable. I highly recommend you to select <code>dirsearch</code> when you need fast fuzzing sessions. </p>

<p>Since I was in <code>Bilkent Network</code>, it did not allow me to use all payloads in <code>directory-list-2.3-medium.txt</code>. As you can see below, tool seems to be bugged.</p>

<p><img src="./images/7.png" alt="alt text" /></p>

<p>I switched on <code>2100</code> endpoint direction. This is what HTML rendered:</p>

<p><img src="./images/8.png" alt="alt text" /></p>

<p><code>HTML</code> source file indicates such an extension <code>.ticket</code>. I should find a way to fuzz both <code>2100</code> endpoint and specific extension called <code>.ticket</code>. Checking <code>-h</code> parameter or <code>man</code> is a great method to get parameters with specific purpose.</p>

<p><code>-h</code> parameter was complicated to find necessary information about <code>extension</code> utility. That's why, I directly opened <code>manual pages</code> and found extension specific parameter.</p>

<p><img src="./images/10.png" alt="alt text" /></p>

<p>By using <code>-e</code> parameter we can achieve <code>.ticket</code> extension files.</p>

<p><img src="./images/9.png" alt="alt text" /></p>

<p><code>Dirsearch</code> did not find anything ,so I shifted through B plan, <code>gobuster</code>. You must be patient to get results on <code>fuzzing</code> phases.</p>

<h3>Dirsearch Result:</h3>

<p><img src="./images/12.png" alt="alt text" /></p>

<h3>Gobuster Result:</h3>

<p><img src="./images/11.png" alt="alt text" /></p>

<p>I found an interesting string <code>RTy8yhBQdscX</code> appears to be <code>encoding</code> format.</p>

<p><img src="./images/13.png" alt="alt text" /></p>

<p><a href="https://gchq.github.io/CyberChef/">Cyberchef</a> could help me to decode it ,but it did not find.</p>

<p><a href="https://www.dcode.fr/cipher-identifier">dcode</a> detected many options for decoding resulting from <code>PlayFair Cipher</code> to <code>Substitution Cipher</code>.</p>

<p><img src="./images/14.png" alt="alt text" /></p>

<p>After I applied all of them, <code>Base 58</code> was the most meaningful result compared to others.</p>

<p><code>
!#th3h00d
</code></p>

<p>```
Ohhh Noo, Don't Talk...............</p>

<p>I wasn't Expecting You at this Moment. I will meet you there</p>

<p>You should find a way to Lian_Yu as we are planed. The Code Word is:
vigilante
```</p>

<p>Maybe, the <code>vigilante</code> or <code>!#th3h00d</code> is the user:pass combination. Vigilante was more likely a username ,so I initially tried it on <code>FTP server</code>.</p>

<p>GOTCHA ! ! !
<img src="./images/15.png" alt="alt text" /></p>

<p>After I logged in successfully, interacting with <code>FTP</code> was crucial for file download process.</p>

<p>To list <code>directories</code>, <code>files</code>:</p>

<p>```
ls -al</p>

<p>dir
```</p>

<p>To download files from <code>FTP</code> client:</p>

<p><code>
GET [File_Name]
</code></p>

<p>Unless you understand, check it below:</p>

<p><img src="./images/16.png" alt="alt text" /></p>

<h3>Do not forget that FTP client will drop your files from which directory that you run.</h3>

<p>Since my files are located on <code>/usr/share/wordlists/SecLists/Discovery/Web-Content</code>, I want to move them to my <code>Desktop</code> directory.</p>

<p><code>
mv Leave_me_alone.png aa.jpg Queen\'s_Gambit.png ../../../../../../home/kali/Desktop
</code></p>

<p>I should analyze image files with the techniques of <code>steganography</code>. Specifically, in order to apply image steganorgraphy, I needed to find proper tools. Today, I would like to run <code>exiftool</code>.</p>

<p>After a couple of attempt, I did not find juicy data on images ,but one of the instance  did not match its file format called <code>Leave_me_alone.png</code>.</p>

<p><img src="./images/18.png" alt="alt text" /></p>

<p>A normal result should looked like that:</p>

<p><img src="./images/17.png" alt="alt text" /></p>

<p>You can also verify through <code>Image Viewer</code> which is a default image application in kali environment.</p>

<p><img src="./images/19.png" alt="alt text" /></p>

<p><img src="./images/20.png" alt="alt text" /></p>

<p>Further image analyze must be done ,so let's use <code>hexedit</code> and modify its first line. As you can see below, leave<em>me</em>alone does not match with .PNG format. Moreover, you can reach out the long description and magic numbers of many extension from here: <a href="https://gist.github.com/leommoore/f9e57ba2aa4bf197ebc5">File Magic Numbers</a> . </p>

<p><img src="./images/21.png" alt="alt text" /></p>

<p><img src="./images/22.png" alt="alt text" /></p>

<p>In my first attempt, I could not convert correct format ,but I found a different source giving full format of <code>PNG</code>. On this <a href="https://www.netspi.com/blog/technical-blog/web-application-pentesting/magic-bytes-identifying-common-file-formats-at-a-glance/">website</a> you will find appropriate format.</p>

<p><img src="./images/23.png" alt="alt text" /></p>

<p>Now it worked ! It indicated a <code>password</code> for something. At first I applied it on <code>SSH</code> ,but it did not true. After that let's also use <code>steghide</code> because kali gave me the clue about it. The image consisting data inside.</p>

<p><img src="./images/24.png" alt="alt text" /></p>

<p><code>
┌──(root㉿kali)-[/home/kali/Desktop]
└─# steghide extract -sf Leave_me_alone.png
Enter passphrase: 
steghide: the file format of the file "Leave_me_alone.png" is not supported.
</code></p>

<p>Maybe other image formats may work:</p>

<p><code>
┌──(root㉿kali)-[/home/kali]
└─# steghide extract -sf aa.jpg
Enter passphrase: 
wrote extracted data to "ss.zip".
</code></p>

<p>YES !
Furthermore, the man appeared was the same as <code>aa.jpg</code> and <code>Leave_me_alone.png</code>. Anyway, use <code>unzip</code> to extract data inside the archive.</p>

<p><img src="./images/25.png" alt="alt text" /></p>

<p>Content of the <code>passwd.txt</code>:</p>

<p>```
This is your visa to Land on Lian_Yu # Just for Fun <em>*</em></p>

<p>a small Note about it</p>

<p>Having spent years on the island, Oliver learned how to be resourceful and 
set booby traps all over the island in the common event he ran into dangerous
people. The island is also home to many animals, including pheasants,
wild pigs and wolves.
```</p>

<p>Obtain a string most likely password of the <code>SSH</code>.</p>

<p><img src="./images/26.png" alt="alt text" /></p>

<p>However, I could not find any <code>username</code> for it. Vigilante did not work. I instantly move on <code>FTP</code> again. There was a hidden file named <code>.other_user</code>.</p>

<p><img src="./images/27.png" alt="alt text" /></p>

<p>Reaching was impossible on that. Therefore, there was only one opportunity to deal with that issue. <code>Further Reconnaissance</code> is mandatory to reach username. What if I move parent directory on <code>FTP</code> ?</p>

<p>GOTCHA ! ! !</p>

<p>I found a different user rather than <code>vigilante</code>:</p>

<p><img src="./images/28.png" alt="alt text" /></p>

<p>I successfully reached the target instance through <code>SSH</code> with this credential:</p>

<p><code>
user:pass
slade:M3tahuman
</code></p>

<p><img src="./images/29.png" alt="alt text" /></p>

<h2>Exploitation</h2>

<p>Get your <code>user</code> flag from here:</p>

<p><img src="./images/30.png" alt="alt text" /></p>

<p>Now, lets check which commands we can run on <code>slade</code> account:</p>

<p><code>
sudo -l
</code></p>

<p>Give its password:</p>

<p><code>
slade@LianYu:~$ sudo -l
[sudo] password for slade: #M3tahuman
Matching Defaults entries for slade on LianYu:
</code></p>

<p><img src="./images/31.png" alt="alt text" /></p>

<p>The binary called <code>pkexec</code> can be run on this account. I checked the <code>GFTObins</code> for this binary.</p>

<p><a href="https://gtfobins.github.io/gtfobins/pkexec/">pkexec documentation</a></p>

<p><code>GFTObins</code> claims that we can directly be <code>root</code> just using below command:</p>

<p><img src="./images/32.png" alt="alt text" /></p>

<p>What exactly <code>pkexec</code> does ?</p>

<p><code>pkexec</code> is part of the PolicyKit package and it is used to execute commands as another user. Typically with root privileges. By using <code>/bin/sh</code> with <code>sudo</code> target may deploy a shell with root privileges.</p>

<p>YESSS !!!!
Reach out the PoC of the <code>binary exploitation</code>.</p>

<p><img src="./images/33.png" alt="alt text" /></p>

<p>Get your flag directly on the same directory:</p>

<p><img src="./images/34.png" alt="alt text" /></p>

<p>May The Pentest Be With You ! ! !</p>

<p><img src="./images/pentest.jpg" alt="alt text" /></p>
</body></html>