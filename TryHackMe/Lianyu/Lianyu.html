<html><head>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
        background-color: #f4f4f4;
    }
    h1, h2, h3 {
        color: #333;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    p {
        margin-bottom: 20px;
    }
    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto 20px auto;
    }
    code {
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 5px;
    }
    pre {
        background-color: #333;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
    }
</style>
</head><body><p>Hi everyone! Today I will analyze the machine called "Lianyu" on the TryHackMe platform. Before you begin, please make sure to add your IPv4 address to <code>/etc/hosts</code>.</p>

<p><img src="./images/1.png" alt="alt text" /></p>

<p>Firstly, run your <code>VPN</code> configuration file then try to <code>ping</code> the target so that you can understand whether you can communicate with target server or not.</p>

<p><img src="./images/2.png" alt="alt text" /></p>

<p>Gotcha !</p>

<h2>Reconnaissance:</h2>

<p>Checking the most common ports is beneficial due to the time constraints typically involved in penetration testing.</p>

<p>Payload:</p>

<p><code>
curl http://lianyu.thm:80
curl http://lianyu.thm:8080
</code></p>

<p><img src="./images/3.png" alt="alt text" /></p>

<p><img src="./images/4.png" alt="alt text" /></p>

<p>As you can see, there are no applications running on ports <code>8080</code> and <code>443</code>.</p>

<p><code>Wappalyzer</code> only identified the web server software.</p>

<p><img src="./images/5.png" alt="alt text" /></p>

<p>Since there was nothing interesting in the page source, I moved on to automated reconnaissance. After running <code>common.txt</code> from the dirb directory, I decided to use <code>directory-list-2.3-medium.txt</code>, which revealed only one endpoint in the web application:</p>

<p><code>
dirsearch -u http://lianyu.thm -w/usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-medium. txt
</code></p>

<p><img src="./images/6.png" alt="alt text" />
I also applied extended fuzzing on the <code>/island</code> endpoint. Using <code>directory-list-2.3-medium.txt</code> was a good choice. I highly recommend <code>dirsearch</code> for fast fuzzing sessions.</p>

<p>However, since I was on the Bilkent Network, I could not use all the payloads in <code>directory-list-2.3-medium.txt</code>. The tool appeared to have some bugs, as shown below.</p>

<p><img src="./images/7.png" alt="alt text" /></p>

<p>Next, I switched to the <code>2100</code> endpoint. This is what the HTML rendered:</p>

<p><img src="./images/8.png" alt="alt text" /></p>

<p>The HTML source indicated an extension <code>.ticket</code>. I needed to fuzz both the <code>2100</code> endpoint and the <code>.ticket</code> extension. Using the <code>-h</code> parameter did not help much, so I checked the <code>manual pages</code> and found the appropriate parameter for handling extensions.</p>

<p><img src="./images/10.png" alt="alt text" /></p>

<p>By using the <code>-e</code> parameter, we can target <code>.ticket</code> extension files.</p>

<p><img src="./images/9.png" alt="alt text" /></p>

<p>Even though <code>Dirsearch</code> didn’t find anything, I switched to my B plan, which was <code>Gobuster</code>. Remember to be patient during fuzzing phases !</p>

<h3>Dirsearch Result:</h3>

<p><img src="./images/12.png" alt="alt text" /></p>

<h3>Gobuster Result:</h3>

<p><img src="./images/11.png" alt="alt text" /></p>

<p>I found an interesting string: <code>RTy8yhBQdscX</code>. This appeared to be in an <code>encoded format</code>.</p>

<p><img src="./images/13.png" alt="alt text" /></p>

<p><a href="https://gchq.github.io/CyberChef/">Cyberchef</a> couldn't decode it, but <code>dCode</code> suggested several possible decoding methods, from the <code>PlayFair cipher</code> to the <code>Substitution cipher</code>.</p>

<p><a href="https://www.dcode.fr/cipher-identifier">dcode</a> detected many options for decoding resulting from <code>PlayFair Cipher</code> to <code>Substitution Cipher</code>.</p>

<p><img src="./images/14.png" alt="alt text" /></p>

<p>After trying multiple options, the most meaningful result came from <code>Base58</code>:</p>

<p><code>
!#th3h00d
</code></p>

<p>```
Ohhh Noo, Don't Talk...............</p>

<p>I wasn't Expecting You at this Moment. I will meet you there</p>

<p>You should find a way to Lian_Yu as we are planed. The Code Word is:
vigilante
```</p>

<p>I suspected that <code>vigilante</code> might be the username and <code>!#th3h00d</code> the password. I tried this combination on the <code>FTP server</code>.</p>

<p>GOTCHA ! ! !
<img src="./images/15.png" alt="alt text" /></p>

<p>Once logged in, interacting with <code>FTP</code> was crucial for downloading files.</p>

<p>To list directories and files, use:</p>

<p>```
ls -al</p>

<p>dir
```</p>

<p>To download files from <code>FTP</code> client:</p>

<p><code>
GET [File_Name]
</code></p>

<p>Unless you understand, check it below:</p>

<p><img src="./images/16.png" alt="alt text" /></p>

<h3>Make sure to check which directory you are in, as FTP will drop your files there. I wanted to move the downloaded files to my Desktop:</h3>

<p>Since my files are located on <code>/usr/share/wordlists/SecLists/Discovery/Web-Content</code>, I wanted to move them to my <code>Desktop</code> directory.</p>

<p><code>
mv Leave_me_alone.png aa.jpg Queen\'s_Gambit.png ../../../../../../home/kali/Desktop
</code></p>

<p>I needed to use <code>steganography techniques</code> to analyze the image files. Initially, I ran <code>exiftool</code>, but no valuable data was found in most images. However, one image, <code>Leave_me_alone.png</code>, did not match its <code>file format</code>.</p>

<p>After a couple of attempt, I did not find juicy data on images ,but one of the instance  did not match its file format called <code>Leave_me_alone.png</code>.</p>

<p><img src="./images/18.png" alt="alt text" /></p>

<p>A normal result should looked like that:</p>

<p><img src="./images/17.png" alt="alt text" /></p>

<p>You can also verify through <code>Image Viewer</code> which is a default image application in kali environment.</p>

<p><img src="./images/19.png" alt="alt text" /></p>

<p><img src="./images/20.png" alt="alt text" /></p>

<p>Further image analyze must be done ,so let's use <code>hexedit</code> and modify its first line. As you can see below, leave<em>me</em>alone does not match with .PNG format. Moreover, you can reach out the long description and magic numbers of many extension from here: <a href="https://gist.github.com/leommoore/f9e57ba2aa4bf197ebc5">File Magic Numbers</a> . </p>

<p><img src="./images/21.png" alt="alt text" /></p>

<p><img src="./images/22.png" alt="alt text" /></p>

<p>In my first attempt, I could not convert correct format ,but I found a different source giving full format of <code>PNG</code>. On this <a href="https://www.netspi.com/blog/technical-blog/web-application-pentesting/magic-bytes-identifying-common-file-formats-at-a-glance/">website</a> you will find appropriate format.</p>

<p><img src="./images/23.png" alt="alt text" /></p>

<p>At first, I tried this password on <code>SSH</code>, but it didn’t work. Later, Kali hinted that <code>steghide</code> could be useful as the image likely contained hidden data.</p>

<p><img src="./images/24.png" alt="alt text" /></p>

<p><code>
┌──(root㉿kali)-[/home/kali/Desktop]
└─# steghide extract -sf Leave_me_alone.png
Enter passphrase: 
steghide: the file format of the file "Leave_me_alone.png" is not supported.
</code></p>

<p>Maybe other image formats may work:</p>

<p><code>
┌──(root㉿kali)-[/home/kali]
└─# steghide extract -sf aa.jpg
Enter passphrase: 
wrote extracted data to "ss.zip".
</code></p>

<p>YES !
Furthermore, the man appeared was the same as <code>aa.jpg</code> and <code>Leave_me_alone.png</code>. Anyway, use <code>unzip</code> to extract data inside the archive.</p>

<p><img src="./images/25.png" alt="alt text" /></p>

<p>Content of the <code>passwd.txt</code>:</p>

<p>```
This is your visa to Land on Lian_Yu # Just for Fun <em>*</em></p>

<p>a small Note about it</p>

<p>Having spent years on the island, Oliver learned how to be resourceful and 
set booby traps all over the island in the common event he ran into dangerous
people. The island is also home to many animals, including pheasants,
wild pigs and wolves.
```</p>

<p>The file also contained a small note about traps set on the island. I now had what seemed to be an <code>SSH password</code> but no <code>username</code>.</p>

<p>Obtain a string most likely password of the <code>SSH</code>.</p>

<p><img src="./images/26.png" alt="alt text" /></p>

<p>However, I could not find any <code>username</code> for it. Vigilante did not work. I instantly move on <code>FTP</code> again. There was a hidden file named <code>.other_user</code>.</p>

<p><img src="./images/27.png" alt="alt text" /></p>

<p>I returned to the FTP server, where I discovered a hidden file named <code>.other_user</code>. Accessing it was impossible, so I explored the parent directory on FTP.</p>

<p>GOTCHA ! ! !</p>

<p>I found a different user rather than <code>vigilante</code>:</p>

<p><img src="./images/28.png" alt="alt text" /></p>

<p>I successfully reached the target instance through <code>SSH</code> with this credential:</p>

<p><code>
user:pass
slade:M3tahuman
</code></p>

<p><img src="./images/29.png" alt="alt text" /></p>

<h2>Exploitation</h2>

<p>Get your <code>user</code> flag from here:</p>

<p><img src="./images/30.png" alt="alt text" /></p>

<p>Once inside, I checked the commands I could run on the <code>slade</code> account:</p>

<p><code>
sudo -l
</code></p>

<p>Give its password:</p>

<p><code>
slade@LianYu:~$ sudo -l
[sudo] password for slade: #M3tahuman
Matching Defaults entries for slade on LianYu:
</code></p>

<p><img src="./images/31.png" alt="alt text" /></p>

<p>The binary <code>pkexec</code> was available, which could be exploited for privilege escalation.</p>

<p><a href="https://gtfobins.github.io/gtfobins/pkexec/">pkexec documentation</a></p>

<p>According to <code>GTFOBins</code>, <code>pkexec</code> allows us to execute commands as another user, typically with root privileges.</p>

<p><img src="./images/32.png" alt="alt text" /></p>

<p>What exactly <code>pkexec</code> does ?</p>

<p><code>pkexec</code> is part of the PolicyKit package and it is used to execute commands as another user. Typically with root privileges. By using <code>/bin/sh</code> with <code>sudo</code> target may deploy a shell with root privileges.</p>

<p>YESSS !!!!</p>

<p>By using this method, I gained root access and obtained the final flag from the same directory.
Reach out the PoC of the <code>binary exploitation</code>.</p>

<p><img src="./images/33.png" alt="alt text" /></p>

<p>Get your flag directly on the same directory:</p>

<p><img src="./images/34.png" alt="alt text" /></p>

<p>May The Pentest Be With You ! ! !</p>

<p><img src="./images/pentest.jpg" alt="alt text" /></p>
</body></html>